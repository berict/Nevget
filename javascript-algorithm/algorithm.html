<html>
<body>
    <p id="result">NULL</p>
    <br>

    <button onclick="calculate()">Calculate</button>
    <br>

    <canvas id="canvas" width="1000" height="100" style="margin-top: 100px"></canvas>

    <script type="text/javascript">
        var x = 0;
        var y = 0;
        var level = 1;
        var last_interval_date = 0;

        function calculate() {
            var age = 20;
            var e = 2.71828182;

            y = Math.pow(e, -(x / (1.898 * (Math.pow(level, 2)))));
            document.getElementById("result").innerHTML = "Day " + Math.round((x + last_interval_date) * 10) + ", Rate " + y.toFixed(5);
            drawCanvas();

            if (y <= 0.9) {
                sendEmail(level, (x + last_interval_date) * 10, age);
                level++;
                last_interval_date += x;
                x = 0;
            }
            x += 0.1;
        }

        function sendEmail(level, x, age) {
            alert("Email sent : level " + level + ", day " + Math.round(x) + ", age " + age);
        }

        function drawCanvas() {
            var canvas = document.getElementById('canvas');
            var context = canvas.getContext('2d');

            context.fillRect(((x + last_interval_date) * 10) * 2, 100 - Math.round(y * 100), 2, 2);
        }
    </script>
</body>
</html>
